<!doctype html>
<html lang="en">

    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">


        <!-- Bootstrap core CSS -->
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
              integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">

        <!-- Favicons -->
        <link rel="apple-touch-icon" href="/docs/5.0/assets/img/favicons/apple-touch-icon.png" sizes="180x180">
        <link rel="icon" href="/docs/5.0/assets/img/favicons/favicon-32x32.png" sizes="32x32" type="image/png">
        <link rel="icon" href="/docs/5.0/assets/img/favicons/favicon-16x16.png" sizes="16x16" type="image/png">
        <link rel="mask-icon" href="/docs/5.0/assets/img/favicons/safari-pinned-tab.svg" color="#7952b3">
        <link rel="icon" href="/docs/5.0/assets/img/favicons/favicon.ico">
        <meta name="theme-color" content="#7952b3">

        <style>
          .bd-placeholder-img {
            font-size: 1.125rem;
            text-anchor: middle;
            -webkit-user-select: none;
            -moz-user-select: none;
            user-select: none;
          }

          @media (min-width: 768px) {
            .bd-placeholder-img-lg {
              font-size: 3.5rem;
            }
          }

          body {
          min-height: 75rem;
          padding-top: 4.5rem;
          }

        .form-container{
          padding:10px;
          padding-bottom:25px;
          margin:0 auto;
          margin-top:20px;
          width:50%;
          border-radius:20px;
          background-color: #ececec;
        }

        .add-one{
          color:green;
          text-align:center;
          font-weigth:bolder;
          cursor:pointer;
          margin-top:10px;
        }

        .delete{
          color:white;
          background-color:rgb(231, 76, 60);
          text-align:center;
          margin-top:6px;
          font-weight:700;
          border-radius:5px;
          min-width:20px;
          cursor:pointer;
        }

        #singlebutton{
          width:100%;
          margin-top:20px;
        }

        .title{
          text-align:center;
          font-size:40px;
          margin-bottom:40px;
        }

        .dynamic-element{
          margin-bottom:0px;
        }
        </style>

    </head>

    <body>

    <!-- HEADER -->
    <nav class="navbar navbar-expand-md navbar-dark fixed-top bg-dark">
        <div class="container-fluid">
            <div class="collapse navbar-collapse" id="navbarCollapse">
                <ul class="navbar-nav me-auto mb-2 mb-md-0">
                    <li class="nav-item">
                        <a class="nav-link active" aria-current="page" href="/index">Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">Hola {{usuario.nombreUsuario}}</a>
                    </li>
                </ul>
                <div class="d-flex">
                    <a class="nav-link active" aria-current="page" href="/logout">Cerrar Sesion</a>
                </div>
            </div>
        </div>
    </nav>
    <!-- END HEADER -->

    <!-- BODY -->
        <main class="container">
            <div class="bg-light p-5 rounded">
                <div class="col-12"><h1>Carga de Trayecto</h1></div>
            </div>

            <div class="bg-light p-5 rounded">
                <div class="col-12"><h3>Rellene el formulario</h3></div>
            </div>

            <!-- FORM -->
            <form class="bg-light p-5 rounded" name="tr_form" action="/trayecto" method="post">
                <fieldset class="form-group">

                    <div class="row">
                        <legend class="col-form-label col-12 pt-0">Elija los integrantes del trayecto</legend>
                        <div class="form-group col-3">
                            <label for="miembro_1">Integrante 1</label>
                            <select name=miembro_1 id="miembro_1" class="form-control">
                                <option value="null">Choose...</option>
                                {{#each miembros}}
                                    <option value="{{id}}">{{apellido}}, {{nombre}}</option>
                                {{/each}}
                            </select>
                        </div>
                        <div class="form-group col-3">
                            <label for="miembro_2">Integrante 2</label>
                            <select name=miembro_2 id="miembro_2" class="form-control">
                                <option value="null">Choose...</option>
                                {{#each miembros}}
                                    <option value="{{id}}">{{apellido}}, {{nombre}}</option>
                                {{/each}}
                            </select>
                        </div>
                        <div class="form-group col-3">
                            <label for="miembro_3">Integrante 3</label>
                            <select name=miembro_3 id="miembro_3" class="form-control">
                                <option value="null">Choose...</option>
                                {{#each miembros}}
                                    <option value="{{id}}">{{apellido}}, {{nombre}}</option>
                                {{/each}}
                            </select>
                        </div>
                        <div class="form-group col-3">
                            <label for="miembro_4">Integrante 4</label>
                            <select name=miembro_4 id="miembro_4" class="form-control">
                                <option value="null">Choose...</option>
                                {{#each miembros}}
                                    <option value="{{id}}">{{apellido}}, {{nombre}}</option>
                                {{/each}}
                            </select>
                        </div>
                    </div>

                    <!-- TRAMOS -->

                    <div class="bg-light p-5 rounded">
                        <div class="row">
                            <div class="col-4"><h5>Tramos:</h5></div>
                            <div class="col-4"><h6>Ingresar puntos como grados decimales (Ejemplo: "15.4,14.5")</h6></div>
                            <div class="form-group col-4">
                                <label for="cant">Cantidad realizada por mes</label>
                                <input name="cant" class="form-control" id="cant">
                            </div>
                        </div>
                    </div>
                    <div class="row form_field_outer">
                        <div class="form_field_outer_row"></div>

                        <div class="form-group">
                            <div class="row">
                                <div class="col-12">
                                    <p class="add-one">+ Añadir Tramo</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-9"></div>
                        <div class="col-3">
                            <button id="singlebutton" name="singlebutton" class="btn btn-primary" type="submit">Enviar</button>
                        </div>
                    </div>

                </fieldset>
            </form>
            <!-- END FORM -->

        </main>


    <div class="form-group dynamic-element" style="display:none">
            <div class="row">

                <div class="form-group col-3">

                    <label for="transporte_1">Medio Transporte</label>
                    <select name="transporte[]" id="transporte_1" class="form-control">
                        <option value="null">Choose...</option>
                        {{#each medio_transportes}}
                            <option value="{{id}}">{{nombre}}</option>
                        {{/each}}
                    </select>

                </div>
                <div class="form-group col-3">
                    <label for="punto_inicio_1">Punto Inicio Tramo</label>
                    <input name="punto_inicio[]" class="form-control" id="punto_inicio_1">
                </div>
                <div class="form-group col-3">
                    <label for="punto_fin_1">Punto Fin Tramo</label>
                    <input name="punto_fin[]" class="form-control" id="punto_fin_1">
                </div>
                <div class="col-1">
                    <p class="delete">x</p>
                </div>
            </div>

            <br>
        </div>




        <script type="text/javascript" src="https://code.jquery.com/jquery-latest.min.js"></script>

        <script>
            //Añadir tramo
            $(document).ready(function(){
            $("body").on("click",".add-one", function (){ console.log("clicked");
            var index = $(".form_field_outer").find(".form_field_outer_row").length;
            $(".form_field_outer").append(`
            <div class="form_field_outer_row">
                <div class="row">
                    <div class="form-group col-2">
                        <label for="is_publico_${index}">Tipo Transporte</label>
                        <select id="is_publico_${index}" class="form-control" onChange="cambiarTransportes(${index})">
                            <option value="null">Choose...</option>
                            <option value="no_publico">No Publico</option>
                            <option value="publico">Publico</option>
                        </select>
                    </div>
                    <div class="form-group col-3">
                        <label for="transporte_${index}">Medio Transporte</label>
                        <select name="transporte[${index}]" id="transporte_${index}" class="form-control" onChange="cambiarPuntos(${index}, this.value)">
                            <option value="null">Choose...</option>

                        </select>
                    </div>
                    <div class="form-group col-3">
                        <label for="punto_inicio_${index}">Punto Inicio Tramo</label>
                        <input name="punto_inicio[${index}]" id="punto_inicio_${index}" class="form-control" list="punto_ini_list_${index}">
                        <datalist id="punto_ini_list_${index}">
                        <option value="">...</option>
                        </datalist>
                    </div>
                    <div class="form-group col-3">
                        <label for="punto_fin_${index}">Punto Fin Tramo</label>
                        <input name="punto_fin[${index}]" class="form-control" id="punto_fin_${index}" list="punto_fin_list_${index}">
                        <datalist id="punto_fin_list_${index}">
                        <option value="">...</option>
                        </datalist>
                    </div>
                    <div class="col-1">
                        <p class="delete">x</p>
                    </div>
                </div>
                <br>
            </div>
            `);
            });
            });

            //Borrar tramo
            $(document).ready(function () {
              $("body").on("click", ".delete", function () {
                $(this).closest(".form_field_outer_row").remove();
                console.log("success");
              });
            });

            function cambiarTransportes(index) {

                console.log("modifico row " + index);

                var publico = {
                    {{#each publicos}}
                       "{{id}}":"{{nombre}}",
                    {{/each}}
                };
                var privado = {
                    {{#each noPublicos}}
                       "{{id}}":"{{nombre}}",
                    {{/each}}
                };

                var $tipoTransporte =  document.getElementById("is_publico_" + index).value;
                var $medioTransporte = document.getElementById("transporte_" + index);
                if ($tipoTransporte === "Choose...") {
                  console.log($tipoTransporte);
                    return;
                } else if ($tipoTransporte === "publico") {
                    meterDatos(publico, $medioTransporte);

                } else {
                    meterDatos(privado, $medioTransporte);
                }

                console.log("end");

            }

            function cambiarPuntos(index, value){
                console.log("modifico row" + index);

                {{#each publicos}}
                    if (value === "{{id}}"){
                        var puntos = {
                            {{#each paradas}}
                                "{{punto.latitud}},{{punto.longitud}}":"{{nombre}}",
                            {{/each}}
                        }
                    }
                {{/each}}

                var $ini = document.getElementById("punto_ini_list_" + index);
                var $fin = document.getElementById("punto_fin_list_" + index);
                meterDatos2(puntos, $ini);
                meterDatos2(puntos, $fin);
            }

            function meterDatos(lista, elemento) {
                elemento.innerHTML = "";

                option_default = document.createElement( 'option' );
                option_default.value = "null";
                option_default.text = "Choose...";
                elemento.appendChild(option_default);

                $.each(lista, function(key, value) {
                    option = document.createElement( 'option' );
                    option.value= key;
                    option.text = value;
                    elemento.appendChild(option);
                });
            }

            function meterDatos2(lista, elemento) {
                elemento.innerHTML = "";

                $.each(lista, function(key, value) {
                    option = document.createElement( 'option' );
                    option.value= key;
                    option.text = value;
                    elemento.appendChild(option);
                });
            }
        </script>

    </body>
</html>